---
title: "Fun with Snippet Variable Transforms"
date: "2018-02-03T10:57:31-05:00"
layout: post
draft: true
path: "/posts/Fun With-Snippet-Transforms/"
category: "Tools"
description: "Where I battle with regexp again"
tags:
  - "VS Code"
  - "Regex"
---

I have never used snippets much but now I have found a good use for [snippets in VS Code](https://code.visualstudio.com/docs/editor/userdefinedsnippets). I am using a [gatsby snippet extension](https://marketplace.visualstudio.com/items?itemName=nickytonline.vscode-gatsby-snippets) to insert the header in my blog markdown. Unfortunately the extension looks like it was designed for VSCode on OSX or Linux. I think the snippet assumes that you have an index.md inside a folder so it attempts to derive the path from `TM_DIRECTORY`. If you follow a practice of naming the folder something reasonable you can use the folder name as your path. My folder names follow the pattern of `YYYY-MM--DD---My-Blog-Title` Using this convention I want to derive the path to be `/posts/My-Blog-Title`. I set out to hack the snippet definition which looks like this. It's a bit daunting because it's json with quoted text with regexp. Plus you need to get familiar with Variable Transforms in snippets. 

``` json
{
  "GatsbyJS article/post": {
    "prefix": "ga",
    "body": [
      "---",
      "title: \"${1:Title}\"",
      "date: \"20${2:17}-${3:01}-${4:01}T${5:00}:00:00Z\"",
      "layout: post",
      "draft: ${6|true,false|}",
      "path: \"\/${7:${TM_DIRECTORY/\\/.+\\/(.+)$/$1/}}\/\"",
      "category: \"${8:Category}\"",
      "description: \"${9:Description}\"",
      "tags:",
      "  - \"${10:Tag}\"",
      "---",
      "",
      "${11:An article about ${1}}"
    ],
    "description": "Markdown template for GatsbyJS article/post"
  },
  "GatsbyJS page": {
    "prefix": "gp",
    "body": [
      "---",
      "title: \"${1:Title}\"",
      "layout: page",
      "path: \"\/${2:${TM_DIRECTORY/\\/.+\\/(.+)$/$1/}}\/\"",
      "---",
      "",
      "${3:A page about ${1}}"
    ],
    "description": "Markdown template for GatsbyJS page"
  }
}
```

The part I wanted to change was the path value generated by this:

``` json
"path: \"\/${7:${TM_DIRECTORY/\\/.+\\/(.+)$/$1/}}\/\"",
```

What it is meant to do is return the folder name where the current document is located. The only variable available is `TM_DIRECTORY` which is the full path of the folder. The format of the path is platform dependent so the Variable Transform used by the snippet actually fails on Windows. 

I decided to customize the snippet definition to fix my platform problem and return the exact path that I want. This requires some regex and I am not very comfortable with regex but I can use the awesome[regular expressions 101](https://regex101.com)

I found this neat Positive Lookbehind example and it works on regex 101 

``` regex
(?<=-{3})(.*)
```
[see saved example](https://regex101.com/r/Qstqmu/1)

``` json
{
  "GatsbyJS article/post": {
    "prefix": "ga",
    "body": [
      "---",
      "title: \"${1:Title}\"",
      "date: \"20${2:17}-${3:01}-${4:01}T${5:00}:00:00Z\"",
      "layout: post",
      "draft: ${6|true,false|}",
      "path: \"\/posts\/${TM_DIRECTORY/(.*)---(.*?)(.*)/$3/}/\"",
      "category: \"${8:Category}\"",
      "description: \"${9:Description}\"",
      "tags:",
      "  - \"${10:Tag}\"",
      "---",
      "",
      "${11:An article about ${1}}"
    ],
    "description": "Markdown template for GatsbyJS article/post"
  },
  "GatsbyJS page": {
    "prefix": "gp",
    "body": [
      "---",
      "title: \"${1:Title}\"",
      "layout: page",
      "path: \"\/${2:${TM_DIRECTORY/\\/.+\\/(.+)$/$1/}}\/\"",
      "---",
      "",
      "${3:A page about ${1}}"
    ],
    "description": "Markdown template for GatsbyJS page"
  }
}
```



